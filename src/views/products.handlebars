<header class="headerLogout">
  <a href="/logout"> <button>logout</button></a>
</header>
<div>
{{#if admin}}
  <h1>Bienvenido, administrador {{user.first_name}} {{user.last_name}}</h1>
{{else}}
  <h1>Bienvenido {{user.first_name}} {{user.last_name}}!</h1>
{{/if}}
 
<hr/>  
  <h2>Productos disponibles</h2>
{{#if admin}}
  {{#each payload}}
    <p>{{id}}</p>
    <p>{{title}}</p>
    <p>{{category}}</p>
    <p>{{stock}}</p> 
    <a data-eliminate-product-id="{{id}}"><button>eliminar producto</button></a>
    <p>{{price}}</p>
    <a data-product-id="{{id}}"><button>Add to cart</button></a>
    <hr/>
    {{/each}}
{{else}}
    {{#each payload}}
    <p>{{id}}</p>
    <p>{{title}}</p>
    <p>{{category}}</p>
    <p>{{stock}}</p> 
    <p>{{price}}</p>
    <a data-product-id="{{id}}"><button>Add to cart</button></a>
    <hr/>
    {{/each}}
    {{#if hasPrevPage}}
    <a href="/products?{{prevLink}}"><button>Anterior</button></a>
    {{/if}}
     {{#if hasNextPage}}
    <a href="/products?{{nextLink}}"><button>Siguiente</button></a>
    {{/if}}
{{/if}}
</div>

<script>
  
    const addToCartButtons = document.querySelectorAll('[data-product-id]');

    addToCartButtons.forEach(button => {
      button.addEventListener('click', () => {
      const productId = button.getAttribute('data-product-id');
      

        fetch(`/api/carts/{{user.cart}}/product/${productId}`, {
          method: 'POST', 
        })
        .then(response => {
          if (response.ok) {
            req.logger.info('Producto agregado al carrito correctamente.');
          } else {
            req.logger.error('Error al agregar el producto al carrito.');
          }
        })
        .catch(error => {
          req.logger.error('Error en la solicitud');
        });
      });
    });

  const deleteButtons = document.querySelectorAll('[data-eliminate-product-id]');

    deleteButtons.forEach(button => {
      button.addEventListener('click', () => {
      const eliminateProductId = button.getAttribute('data-eliminate-product-id');
      

        fetch(`/api/products/${eliminateProductId}`, {
          method: 'DELETE', 
        })
        .then(response => {
          if (response.ok) {
            req.logger.info('Producto eliminado correctamente.');
          } else {
            req.logger.error('Error al eliminar el producto.');
          }
        })
        .catch(error => {
          req.logger.error('Error en la solicitud');
        });
      });
    });


  </script>

<script src="/socket.io/socket.io.js"></script>
<script src="js/index.js"></script>
<!--

{{#each payload}}
    <p>{{id}}</p>
    <p>{{title}}</p>
    <p>{{category}}</p>
    <p>{{stock}}</p>
    <p>{{price}}</p>
    {{/each}}
 
    {{#if hasPrevPage}}
    <a href={{prevLink}}><button>Anterior</button></a>
    {{/if}}
     {{#if hasNextPage}}
    <a href={{nextLink}}><button>Siguiente</button></a>
    {{/if}}



-->